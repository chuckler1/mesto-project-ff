(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"ba5e2172-a186-44b4-8733-f33510101419","Content-Type":"application/json"}};function t(e){setTimeout((function(){return e.classList.add("popup_is-opened")}),0),e.classList.add("popup_is-animated"),document.addEventListener("keydown",r)}function n(e){e.classList.remove("popup_is-opened"),setTimeout((function(){return e.classList.remove("popup_is-animated")}),600),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.code&&n(document.querySelector(".popup_is-opened"))}var o=document.querySelector("#card-template").content;function c(r,c,a,s){var u=o.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__image"),p=u.querySelector(".card__like-counter"),_="be23c6910b1b927ebfd495da",f=document.querySelector(".popup_type_delete"),m=f.querySelector(".popup_type_delete__button");return u.querySelector(".card__image").src=r.link,u.querySelector(".card__image").alt=r.name,u.querySelector(".card__title").textContent=r.name,p.textContent=r.likes.length,r.owner._id==_?i.addEventListener("click",(function(){t(f),m.addEventListener("click",(function(){c(u),function(t){fetch("".concat(e.baseUrl,"/cards/").concat(t._id),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r),n(f)}))})):i.style.display="none",r.likes.some((function(e){return e._id==_}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(t){t.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t._id),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r).then((function(e){p.textContent=e.likes.length})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t._id),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r).then((function(e){p.textContent=e.likes.length})),function(e){e.target.classList.toggle("card__like-button_is-active")}(t)})),d.addEventListener("click",s,!0),u}function a(e){e.remove()}var s=function(e,t){var n=Array.from(e.querySelectorAll("input")),r=Array.from(e.querySelectorAll("span")),o=e.querySelector("button");o.classList.add(t.inactiveButtonClass),o.setAttribute("disabled","disabled"),n.forEach((function(e){return e.classList.remove(t.inputErrorClass)})),r.forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""}))},u=document.querySelector(".places__list"),i=document.querySelector(".profile__title"),l=document.querySelector(".profile__description"),d=document.querySelector(".profile__image"),p=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_edit"),f=document.querySelector(".profile__edit-button"),m=_.querySelector(".popup__form"),v=m.elements.name,y=m.elements.description,b=document.querySelector(".popup_type_new-card"),h=document.querySelector(".profile__add-button"),S=b.querySelector(".popup__form"),C=S.elements["place-name"],q=S.elements.link,E=document.querySelector(".popup_type_image"),L=E.querySelector(".popup__image"),k=E.querySelector(".popup__caption"),g=document.querySelector(".popup_type_edit_avatar"),x=g.querySelector(".popup__form"),j=x.elements.link;function A(e){e.target.classList.contains("card__image")&&(L.src=e.target.src,k.textContent=L.alt=e.target.closest(".card").querySelector(".card__title").textContent,t(E))}var P,U,B,T,w,D=function(e){i.textContent=e.name,l.textContent=e.about,d.style.backgroundImage="url(".concat(e.avatar,")")};(P=["".concat(e.baseUrl,"/users/me"),"".concat(e.baseUrl,"/cards")].map((function(t){return fetch(t,{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})),Promise.all(P)).then((function(e){return e.forEach((function(e){e.length?e.forEach((function(e){return function(e){u.append(c(e,a,0,A))}(e)})):D(e)}))})).catch((function(e){return console.log(e)})),f.addEventListener("click",(function(){t(_),v.value=i.textContent,y.value=l.textContent,s(m,{inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),d.addEventListener("click",(function(){t(g),s(x,{inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),x.addEventListener("submit",(function(t){var r;t.preventDefault(),x.elements.button.textContent="Сохранение...",(r=j,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){D(e),x.elements.button.textContent="Сохранить"})),n(g)})),p.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup_is-opened"))&&n(e)}))})),m.addEventListener("submit",(function(t){t.preventDefault(),m.elements.button.textContent="Сохранение...",function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t.value,about:n.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(v,y).then((function(e){D(e),m.elements.button.textContent="Сохранить"})).catch((function(e){return console.log(e)})),n(_)})),h.addEventListener("click",(function(){t(b),C.value="",q.value="",s(S,{inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),S.addEventListener("submit",(function(t){t.preventDefault(),S.elements.button.textContent="Сохранение...",function(t){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}({name:C.value,link:q.value}).then((function(e){u.prepend(c(e,a,0,A)),S.elements.button.textContent="Сохранить"})).catch((function(e){return console.log(e)})),n(b),t.target.reset()})),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},B=Array.from(document.querySelectorAll(U.formSelector)),T=function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(U.inputErrorClass),n.classList.remove(U.errorClass),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(U.inputErrorClass),r.textContent=n,r.classList.add(U.errorClass)}(e,t,t.validationMessage)},w=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(U.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(U.inactiveButtonClass),t.setAttribute("disabled","disabled"))},B.forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(U.inputSelector)),n=e.querySelector(U.submitButtonSelector);w(t,n),t.forEach((function(r){r.addEventListener("input",(function(){T(e,r),w(t,n)}))}))}(e),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();